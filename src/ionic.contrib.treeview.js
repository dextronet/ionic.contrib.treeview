angular.module('ionic.contrib.TreeView', ['ionic']).directive("treeView", [
  "$animate", "$compile", "$timeout", function($animate, $compile, $timeout) {
    return {
      restrict: "E",
      require: ["^?$ionicScroll"],
      template: "<tree-item ng-style=\"{width: fullWidth}\" collection-item-width=\"'100%'\" collection-item-height=\"itemHeight\" collection-repeat=\"row in treeRows | filter:{visible:true} track by row.item.id\" row=\"row\">{{row.item.name}}</tree-item>",
      scope: {
        onExpandChange: '&',
        onCheckboxChange: '&',
        onClick: '&',
        items: '=',
        showCheckboxes: '=',
        showNumbers: '=',
        fetchData: '=',
        hasMoreData: '=',
        itemHeight: '='
      },
      compile: function($element, $attr) {
        var infiniteScroll, listEl;
        listEl = angular.element("<div class=\"tree-view list\">").append($element.contents());
        infiniteScroll = angular.element("<ion-infinite-scroll ng-if=\"hasMoreData()\" on-infinite=\"fetchData()\" distance=\"1%\">");
        $element.append(listEl).append(infiniteScroll);
        return function($scope, $element, $attrs, ctrls) {
          var buildTreeRows, init;
          $scope.fullWidth = '100%';
          buildTreeRows = function(items, level, number, visible) {
            var childrenVisible, index, item, row, rowNumber, _i, _len, _ref, _results;
            if ($attrs.scrollHeight) {
              if ((_ref = $element.parent()[0]) != null) {
                _ref.style.height = $attrs.scrollHeight;
              }
            }
            if (!number) {
              number = [];
            }
            _results = [];
            for (index = _i = 0, _len = items.length; _i < _len; index = ++_i) {
              item = items[index];
              rowNumber = number.slice();
              rowNumber.push(index + 1);
              row = {
                item: item,
                level: level,
                number: rowNumber,
                showCheckbox: item.showCheckbox
              };
              if (item.visible === false) {
                row.visible = item.visible;
              } else {
                row.visible = visible;
              }
              $scope.treeRows.push(row);
              childrenVisible = visible && item.expanded;
              if (item.children) {
                _results.push(buildTreeRows(item.children, level + 1, rowNumber, childrenVisible));
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          };
          init = function() {
            $scope.treeRows = [];
            return buildTreeRows($scope.items, 0, null, true);
          };
          $scope.$watch('items', init, true);
        };
      }
    };
  }
]);

angular.module('ionic.contrib.TreeView').controller("$treeView", ["$scope", "$attrs", "$parse", function($scope, $attrs, $parse) {}]);

var TreeView;

TreeView = ionic.views.View.inherit({
  initialize: function(opts) {
    var _this;
    return;
    _this = this;
    opts = ionic.extend({
      onReorder: function(el, oldIndex, newIndex) {},
      virtualRemoveThreshold: -200,
      virtualAddThreshold: 200,
      canSwipe: function() {
        return true;
      }
    }, opts);
    ionic.extend(this, opts);
    if (!this.itemHeight && this.listEl) {
      this.itemHeight = this.listEl.children[0] && parseInt(this.listEl.children[0].style.height, 10);
    }
    this.onRefresh = opts.onRefresh || function() {};
    this.onRefreshOpening = opts.onRefreshOpening || function() {};
    this.onRefreshHolding = opts.onRefreshHolding || function() {};
    window.ionic.onGesture("release", (function(e) {
      _this._handleEndDrag(e);
    }), this.el);
    window.ionic.onGesture("drag", (function(e) {
      _this._handleDrag(e);
    }), this.el);
    this._initDrag();
  },

  /**
  Called to tell the list to stop refreshing. This is useful
  if you are refreshing the list and are done with refreshing.
   */
  stopRefreshing: function() {
    var refresher;
    refresher = this.el.querySelector(".list-refresher");
    refresher.style.height = "0px";
  },

  /**
  If we scrolled and have virtual mode enabled, compute the window
  of active elements in order to figure out the viewport to render.
   */
  didScroll: function(e) {
    var first, highWater, itemHeight, itemsPerViewport, last, lowWater, nodes, scrollHeight, scrollTop, totalItems, viewportHeight;
    if (this.isVirtual) {
      itemHeight = this.itemHeight;
      totalItems = this.listEl.children.length;
      scrollHeight = e.target.scrollHeight;
      viewportHeight = this.el.parentNode.offsetHeight;
      scrollTop = e.scrollTop;
      highWater = Math.max(0, e.scrollTop + this.virtualRemoveThreshold);
      lowWater = Math.min(scrollHeight, Math.abs(e.scrollTop) + viewportHeight + this.virtualAddThreshold);
      itemsPerViewport = Math.floor((lowWater - highWater) / itemHeight);
      first = parseInt(Math.abs(highWater / itemHeight), 10);
      last = parseInt(Math.abs(lowWater / itemHeight), 10);
      this._virtualItemsToRemove = Array.prototype.slice.call(this.listEl.children, 0, first);
      nodes = Array.prototype.slice.call(this.listEl.children, first, first + itemsPerViewport);
      this.renderViewport && this.renderViewport(highWater, lowWater, first, last);
    }
  },
  didStopScrolling: function(e) {
    var el, i;
    if (this.isVirtual) {
      i = 0;
      while (i < this._virtualItemsToRemove.length) {
        el = this._virtualItemsToRemove[i];
        this.didHideItem && this.didHideItem(i);
        i++;
      }
    }
  },

  /**
  Clear any active drag effects on the list.
   */
  clearDragEffects: function() {
    if (this._lastDragOp) {
      this._lastDragOp.clean && this._lastDragOp.clean();
      this._lastDragOp = null;
    }
  },
  _initDrag: function() {
    this._lastDragOp = this._dragOp;
    this._dragOp = null;
  },
  _getItem: function(target) {
    while (target) {
      if (target.classList && target.classList.contains(ITEM_CLASS)) {
        return target;
      }
      target = target.parentNode;
    }
    return null;
  },
  _startDrag: function(e) {
    var didStart, item, lastDragOp, _this;
    _this = this;
    didStart = false;
    this._isDragging = false;
    lastDragOp = this._lastDragOp;
    item = void 0;
    if (ionic.DomUtil.getParentOrSelfWithClass(e.target, ITEM_REORDER_BTN_CLASS) && (e.gesture.direction === "up" || e.gesture.direction === "down")) {
      item = this._getItem(e.target);
      if (item) {
        this._dragOp = new ReorderDrag({
          listEl: this.el,
          el: item,
          scrollEl: this.scrollEl,
          scrollView: this.scrollView,
          onReorder: function(el, start, end) {
            _this.onReorder && _this.onReorder(el, start, end);
          }
        });
        this._dragOp.start(e);
        e.preventDefault();
      }
    } else if (!this._didDragUpOrDown && (e.gesture.direction === "left" || e.gesture.direction === "right") && Math.abs(e.gesture.deltaX) > 5) {
      item = this._getItem(e.target);
      if (item && item.querySelector(".item-options")) {
        this._dragOp = new SlideDrag({
          el: this.el,
          canSwipe: this.canSwipe
        });
        this._dragOp.start(e);
        e.preventDefault();
      }
    }
    if (lastDragOp && this._dragOp && !this._dragOp.isSameItem(lastDragOp) && e.defaultPrevented) {
      lastDragOp.clean && lastDragOp.clean();
    }
  },
  _handleEndDrag: function(e) {
    var _this;
    _this = this;
    this._didDragUpOrDown = false;
    if (!this._dragOp) {
      return;
    }
    this._dragOp.end(e, function() {
      _this._initDrag();
    });
  },

  /**
  Process the drag event to move the item to the left or right.
   */
  _handleDrag: function(e) {
    var buttons, content, _this;
    _this = this;
    content = void 0;
    buttons = void 0;
    if (Math.abs(e.gesture.deltaY) > 5) {
      this._didDragUpOrDown = true;
    }
    if (!this.isDragging && !this._dragOp) {
      this._startDrag(e);
    }
    if (!this._dragOp) {
      return;
    }
    e.gesture.srcEvent.preventDefault();
    this._dragOp.drag(e);
  }
});

angular.module('ionic.contrib.TreeView').directive("treeItem", [
  "$animate", "$compile", function($animate, $compile) {
    return {
      restrict: "E",
      controller: [
        "$scope", "$element", function($scope, $element) {
          $scope.toggle = function($event, row) {
            $event.stopPropagation();
            row.item.expanded = !row.item.expanded;
            return $scope.onExpandChange({
              row: row
            });
          };
          $scope.checkboxClick = function($event, row) {
            $event.stopPropagation();
            row.item.done = !row.item.done;
            return $scope.onCheckboxChange({
              row: row
            });
          };
          return $scope.rowClick = function(row) {
            return $scope.onClick({
              row: row
            });
          };
        }
      ],
      compile: function($element, $attrs) {
        var link;
        $element.addClass("item item-complex tree-item");
        link = function($scope, $element, $attrs) {
          var checkbox, chevron, containerLink, number, textContainer;
          $scope.getTreePadding = function(row) {
            var padding;
            padding = row.level * 40;
            return {
              'padding-left': padding + 'px'
            };
          };
          $scope.getVisibility = function(row) {
            var _ref;
            if (row.item.hideExpander) {
              return 'hidden';
            } else {
              if (((_ref = row.item.children) != null ? _ref.length : void 0) > 0) {
                return 'visible';
              } else {
                return 'hidden';
              }
            }
          };
          number = angular.element("<span ng-if=\"showNumbers\" class=\"tree-item-number\">{{row.number.join('.')}}:</span>");
          checkbox = angular.element("<label ng-if=\"!(row.showCheckbox || (showCheckboxes && row.showCheckbox !== false))\" style=\"height: 28px; width: 1px; float: left; padding-left: 3px;\"></label> <label ng-if=\"row.showCheckbox || (showCheckboxes && row.showCheckbox !== false)\" class=\"checkbox\"><input type=\"checkbox\" ng-checked=\"row.item.done\" ng-click=\"checkboxClick($event, row)\"> </label>");
          containerLink = angular.element("<a class=\"item-content item-icon-right\" ng-class=\"{'tree-item-with-number': showNumbers, 'tree-item-with-checkbox': true}\" ng-click=\"rowClick(row)\" ng-style=\"getTreePadding(row)\" ></a>");
          chevron = angular.element("<a class=\"expand-button icon ion-chevron-down\" ng-class=\"{'tree-item-expanded': row.item.expanded}\" ng-style=\"{'visibility': getVisibility(row)}\" ng-click=\"toggle($event, row)\"></a>");
          textContainer = angular.element("<span class=\"tree-item-text\"></span>");
          textContainer.append($element.contents());
          containerLink.append(number);
          containerLink.append(checkbox);
          containerLink.append(textContainer).append(chevron);
          $element.append(containerLink);
          $compile(containerLink)($scope);
        };
        return link;
      }
    };
  }
]);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyZWVfdmlld19kaXJlY3RpdmUuY29mZmVlIiwidHJlZV92aWV3X2NvbnRyb2xsZXIuY29mZmVlIiwidHJlZV92aWV3X3ZpZXcuY29mZmVlIiwidHJlZV9pdGVtX2RpcmVjdGl2ZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxDQUFDLE1BQVIsQ0FBZSx3QkFBZixFQUF5QyxDQUFDLE9BQUQsQ0FBekMsQ0FDQSxDQUFDLFNBREQsQ0FDVyxVQURYLEVBQ3VCO0VBQ3JCLFVBRHFCLEVBRXJCLFVBRnFCLEVBR3JCLFVBSHFCLEVBSXJCLFNBQUMsUUFBRCxFQUFXLFFBQVgsRUFBcUIsUUFBckIsR0FBQTtBQUNFLFdBQ0U7QUFBQSxNQUFBLFFBQUEsRUFBVSxHQUFWO0FBQUEsTUFDQSxPQUFBLEVBQVMsQ0FDUCxnQkFETyxDQURUO0FBQUEsTUFLQSxRQUFBLEVBQVUsZ1BBTFY7QUFBQSxNQVNBLEtBQUEsRUFDRTtBQUFBLFFBQUEsY0FBQSxFQUFnQixHQUFoQjtBQUFBLFFBQ0EsZ0JBQUEsRUFBa0IsR0FEbEI7QUFBQSxRQUVBLE9BQUEsRUFBUyxHQUZUO0FBQUEsUUFHQSxLQUFBLEVBQU8sR0FIUDtBQUFBLFFBSUEsY0FBQSxFQUFnQixHQUpoQjtBQUFBLFFBS0EsV0FBQSxFQUFhLEdBTGI7QUFBQSxRQU1BLFNBQUEsRUFBVyxHQU5YO0FBQUEsUUFPQSxXQUFBLEVBQWEsR0FQYjtBQUFBLFFBUUEsVUFBQSxFQUFZLEdBUlo7T0FWRjtBQUFBLE1BbUJBLE9BQUEsRUFBUyxTQUFDLFFBQUQsRUFBVyxLQUFYLEdBQUE7QUFDUCxZQUFBLHNCQUFBO0FBQUEsUUFBQSxNQUFBLEdBQVMsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsZ0NBQWhCLENBQWlELENBQUMsTUFBbEQsQ0FBeUQsUUFBUSxDQUFDLFFBQVQsQ0FBQSxDQUF6RCxDQUFULENBQUE7QUFBQSxRQUNBLGNBQUEsR0FBaUIsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsMkZBQWhCLENBRGpC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QTNDLENBN0RBLENBQUE7QUFBQSxVQStEQSxRQUFRLENBQUMsTUFBVCxDQUFnQixhQUFoQixDQS9EQSxDQUFBO0FBQUEsVUFnRUEsUUFBQSxDQUFTLGFBQVQsQ0FBQSxDQUF3QixNQUF4QixDQWhFQSxDQURLO1FBQUEsQ0FGUCxDQUFBO0FBdUVBLGVBQU8sSUFBUCxDQXhFTztNQUFBLENBbkJUO0tBREYsQ0FERjtFQUFBLENBSDZEO0NBQS9ELENBQUEsQ0FBQSIsImZpbGUiOiJpb25pYy5jb250cmliLnRyZWV2aWV3LmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2lvbmljLmNvbnRyaWIuVHJlZVZpZXcnLCBbJ2lvbmljJ10pXG4uZGlyZWN0aXZlIFwidHJlZVZpZXdcIiwgW1xuICBcIiRhbmltYXRlXCJcbiAgXCIkY29tcGlsZVwiXG4gIFwiJHRpbWVvdXRcIlxuICAoJGFuaW1hdGUsICRjb21waWxlLCAkdGltZW91dCkgLT5cbiAgICByZXR1cm4gKFxuICAgICAgcmVzdHJpY3Q6IFwiRVwiXG4gICAgICByZXF1aXJlOiBbXG4gICAgICAgIFwiXj8kaW9uaWNTY3JvbGxcIlxuICAgICAgXVxuICAgICAgI2NvbnRyb2xsZXI6IFwiJHRyZWVWaWV3XCJcbiAgICAgIHRlbXBsYXRlOiBcIjx0cmVlLWl0ZW0gbmctc3R5bGU9XFxcInt3aWR0aDogZnVsbFdpZHRofVxcXCIgXG4gICAgICAgIGNvbGxlY3Rpb24taXRlbS13aWR0aD1cXFwiJzEwMCUnXFxcIiBjb2xsZWN0aW9uLWl0ZW0taGVpZ2h0PVxcXCJpdGVtSGVpZ2h0XFxcIiBcbiAgICAgICAgY29sbGVjdGlvbi1yZXBlYXQ9XFxcInJvdyBpbiB0cmVlUm93cyB8IGZpbHRlcjp7dmlzaWJsZTp0cnVlfSB0cmFjayBieSByb3cuaXRlbS5pZFxcXCIgXG4gICAgICAgIHJvdz1cXFwicm93XFxcIj57e3Jvdy5pdGVtLm5hbWV9fTwvdHJlZS1pdGVtPlwiLFxuICAgICAgc2NvcGU6IFxuICAgICAgICBvbkV4cGFuZENoYW5nZTogJyYnXG4gICAgICAgIG9uQ2hlY2tib3hDaGFuZ2U6ICcmJ1xuICAgICAgICBvbkNsaWNrOiAnJidcbiAgICAgICAgaXRlbXM6ICc9J1xuICAgICAgICBzaG93Q2hlY2tib3hlczogJz0nXG4gICAgICAgIHNob3dOdW1iZXJzOiAnPSdcbiAgICAgICAgZmV0Y2hEYXRhOiAnPScsXG4gICAgICAgIGhhc01vcmVEYXRhOiAnPScsXG4gICAgICAgIGl0ZW1IZWlnaHQ6ICc9J1xuICAgICAgY29tcGlsZTogKCRlbGVtZW50LCAkYXR0cikgLT5cbiAgICAgICAgbGlzdEVsID0gYW5ndWxhci5lbGVtZW50KFwiPGRpdiBjbGFzcz1cXFwidHJlZS12aWV3IGxpc3RcXFwiPlwiKS5hcHBlbmQoJGVsZW1lbnQuY29udGVudHMoKSlcbiAgICAgICAgaW5maW5pdGVTY3JvbGwgPSBhbmd1bGFyLmVsZW1lbnQoXCI8aW9uLWluZmluaXRlLXNjcm9sbCBuZy1pZj1cXFwiaGFzTW9yZURhdGEoKVxcXCIgb24taW5maW5pdGU9XFxcImZldGNoRGF0YSgpXFxcIiBkaXN0YW5jZT1cXFwiMSVcXFwiPlwiKVxuICAgICAgICAkZWxlbWVudC5hcHBlbmQobGlzdEVsKS5hcHBlbmQoaW5maW5pdGVTY3JvbGwpO1xuICAgICAgICBcbiAgICAgICAgKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgY3RybHMpIC0+XG4gICAgICAgICAgJHNjb3BlLmZ1bGxXaWR0aCA9ICcxMDAlJztcbiAgICAgICAgICBcbiAgICAgICAgICBidWlsZFRyZWVSb3dzID0gKGl0ZW1zLCBsZXZlbCwgbnVtYmVyLCB2aXNpYmxlKSAtPlxuICAgICAgICAgICAgIyBzZXQgY3VzdG9tIFxuICAgICAgICAgICAgaWYgJGF0dHJzLnNjcm9sbEhlaWdodFxuICAgICAgICAgICAgICAkZWxlbWVudC5wYXJlbnQoKVswXT8uc3R5bGUuaGVpZ2h0ID0gJGF0dHJzLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbnVtYmVyID0gW10gdW5sZXNzIG51bWJlclxuICAgICAgICAgICAgZm9yIGl0ZW0sIGluZGV4IGluIGl0ZW1zXG4gICAgICAgICAgICAgIHJvd051bWJlciA9IG51bWJlci5zbGljZSgpXG4gICAgICAgICAgICAgIHJvd051bWJlci5wdXNoIGluZGV4ICsgMVxuICAgICAgICAgICAgICByb3cgPVxuICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW1cbiAgICAgICAgICAgICAgICBsZXZlbDogbGV2ZWxcbiAgICAgICAgICAgICAgICBudW1iZXI6IHJvd051bWJlclxuICAgICAgICAgICAgICAgIHNob3dDaGVja2JveDogaXRlbS5zaG93Q2hlY2tib3hcbiAgICAgICAgICAgICAgaWYgaXRlbS52aXNpYmxlID09IGZhbHNlXG4gICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBpdGVtLnZpc2libGVcbiAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJvdy52aXNpYmxlID0gdmlzaWJsZVxuICAgICAgICAgICAgICAkc2NvcGUudHJlZVJvd3MucHVzaCByb3dcbiAgICAgICAgICAgICAgY2hpbGRyZW5WaXNpYmxlID0gdmlzaWJsZSBhbmQgaXRlbS5leHBhbmRlZFxuICAgICAgICAgICAgICBidWlsZFRyZWVSb3dzIGl0ZW0uY2hpbGRyZW4sIGxldmVsICsgMSwgcm93TnVtYmVyLCBjaGlsZHJlblZpc2libGUgaWYgaXRlbS5jaGlsZHJlblxuXG4gICAgICAgICAgaW5pdCA9IC0+XG4gICAgICAgICAgICAkc2NvcGUudHJlZVJvd3MgPSBbXVxuICAgICAgICAgICAgYnVpbGRUcmVlUm93cyAkc2NvcGUuaXRlbXMsIDAsIG51bGwsIHRydWVcblxuICAgICAgICAgICRzY29wZS4kd2F0Y2ggJ2l0ZW1zJywgaW5pdCwgdHJ1ZVxuXG4gICAgICAgICAgICAjbGlzdEVsLmFwcGVuZCAkY29tcGlsZShhbmd1bGFyLmVsZW1lbnQoXCI8dHJlZS1pdGVtPiN7aXRlbS5uYW1lfTwvdHJlZS1pdGVtPlwiKSwgaXRlbSkoJHNjb3BlKVxuXG4gICAgICAgICAgIyR0aW1lb3V0IGluaXRcblxuICAgICAgICAgIHJldHVyblxuICAgIClcbl0iLCJhbmd1bGFyLm1vZHVsZSgnaW9uaWMuY29udHJpYi5UcmVlVmlldycpXG4uY29udHJvbGxlciBcIiR0cmVlVmlld1wiLCBbXG4gIFwiJHNjb3BlXCJcbiAgXCIkYXR0cnNcIlxuICBcIiRwYXJzZVwiXG4gICgkc2NvcGUsICRhdHRycywgJHBhcnNlKSAtPlxuICAgIFxuICAgIHJldHVyblxuXSIsIlRyZWVWaWV3ID0gaW9uaWMudmlld3MuVmlldy5pbmhlcml0KFxuICBpbml0aWFsaXplOiAob3B0cykgLT5cbiAgICByZXR1cm5cblxuICAgIF90aGlzID0gdGhpc1xuICAgIG9wdHMgPSBpb25pYy5leHRlbmQoXG4gICAgICBvblJlb3JkZXI6IChlbCwgb2xkSW5kZXgsIG5ld0luZGV4KSAtPlxuXG4gICAgICB2aXJ0dWFsUmVtb3ZlVGhyZXNob2xkOiAtMjAwXG4gICAgICB2aXJ0dWFsQWRkVGhyZXNob2xkOiAyMDBcbiAgICAgIGNhblN3aXBlOiAtPlxuICAgICAgICB0cnVlXG4gICAgLCBvcHRzKVxuICAgIGlvbmljLmV4dGVuZCB0aGlzLCBvcHRzXG4gICAgQGl0ZW1IZWlnaHQgPSBAbGlzdEVsLmNoaWxkcmVuWzBdIGFuZCBwYXJzZUludChAbGlzdEVsLmNoaWxkcmVuWzBdLnN0eWxlLmhlaWdodCwgMTApICBpZiBub3QgQGl0ZW1IZWlnaHQgYW5kIEBsaXN0RWxcbiAgICBcbiAgICAjaW9uaWMudmlld3MuTGlzdFZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRzKTtcbiAgICBAb25SZWZyZXNoID0gb3B0cy5vblJlZnJlc2ggb3IgLT5cblxuICAgIEBvblJlZnJlc2hPcGVuaW5nID0gb3B0cy5vblJlZnJlc2hPcGVuaW5nIG9yIC0+XG5cbiAgICBAb25SZWZyZXNoSG9sZGluZyA9IG9wdHMub25SZWZyZXNoSG9sZGluZyBvciAtPlxuXG4gICAgd2luZG93LmlvbmljLm9uR2VzdHVyZSBcInJlbGVhc2VcIiwgKChlKSAtPlxuICAgICAgX3RoaXMuX2hhbmRsZUVuZERyYWcgZVxuICAgICAgcmV0dXJuXG4gICAgKSwgQGVsXG4gICAgd2luZG93LmlvbmljLm9uR2VzdHVyZSBcImRyYWdcIiwgKChlKSAtPlxuICAgICAgX3RoaXMuX2hhbmRsZURyYWcgZVxuICAgICAgcmV0dXJuXG4gICAgKSwgQGVsXG4gICAgXG4gICAgIyBTdGFydCB0aGUgZHJhZyBzdGF0ZXNcbiAgICBAX2luaXREcmFnKClcbiAgICByZXR1cm5cblxuICBcbiAgIyMjKlxuICBDYWxsZWQgdG8gdGVsbCB0aGUgbGlzdCB0byBzdG9wIHJlZnJlc2hpbmcuIFRoaXMgaXMgdXNlZnVsXG4gIGlmIHlvdSBhcmUgcmVmcmVzaGluZyB0aGUgbGlzdCBhbmQgYXJlIGRvbmUgd2l0aCByZWZyZXNoaW5nLlxuICAjIyNcbiAgc3RvcFJlZnJlc2hpbmc6IC0+XG4gICAgcmVmcmVzaGVyID0gQGVsLnF1ZXJ5U2VsZWN0b3IoXCIubGlzdC1yZWZyZXNoZXJcIilcbiAgICByZWZyZXNoZXIuc3R5bGUuaGVpZ2h0ID0gXCIwcHhcIlxuICAgIHJldHVyblxuXG4gIFxuICAjIyMqXG4gIElmIHdlIHNjcm9sbGVkIGFuZCBoYXZlIHZpcnR1YWwgbW9kZSBlbmFibGVkLCBjb21wdXRlIHRoZSB3aW5kb3dcbiAgb2YgYWN0aXZlIGVsZW1lbnRzIGluIG9yZGVyIHRvIGZpZ3VyZSBvdXQgdGhlIHZpZXdwb3J0IHRvIHJlbmRlci5cbiAgIyMjXG4gIGRpZFNjcm9sbDogKGUpIC0+XG4gICAgaWYgQGlzVmlydHVhbFxuICAgICAgaXRlbUhlaWdodCA9IEBpdGVtSGVpZ2h0XG4gICAgICBcbiAgICAgICMgVE9ETzogVGhpcyB3b3VsZCBiZSBpbmFjY3VyYXRlIGlmIHdlIGFyZSB3aW5kb3dlZFxuICAgICAgdG90YWxJdGVtcyA9IEBsaXN0RWwuY2hpbGRyZW4ubGVuZ3RoXG4gICAgICBcbiAgICAgICMgR3JhYiB0aGUgdG90YWwgaGVpZ2h0IG9mIHRoZSBsaXN0XG4gICAgICBzY3JvbGxIZWlnaHQgPSBlLnRhcmdldC5zY3JvbGxIZWlnaHRcbiAgICAgIFxuICAgICAgIyBHZXQgdGhlIHZpZXdwb3J0IGhlaWdodFxuICAgICAgdmlld3BvcnRIZWlnaHQgPSBAZWwucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHRcbiAgICAgIFxuICAgICAgIyBzY3JvbGxUb3AgaXMgdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uXG4gICAgICBzY3JvbGxUb3AgPSBlLnNjcm9sbFRvcFxuICAgICAgXG4gICAgICAjIEhpZ2ggd2F0ZXIgaXMgdGhlIHBpeGVsIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBlbGVtZW50IHRvIGluY2x1ZGUgKGV2ZXJ5dGhpbmcgYmVmb3JlXG4gICAgICAjIHRoYXQgd2lsbCBiZSByZW1vdmVkKVxuICAgICAgaGlnaFdhdGVyID0gTWF0aC5tYXgoMCwgZS5zY3JvbGxUb3AgKyBAdmlydHVhbFJlbW92ZVRocmVzaG9sZClcbiAgICAgIFxuICAgICAgIyBMb3cgd2F0ZXIgaXMgdGhlIHBpeGVsIHBvc2l0aW9uIG9mIHRoZSBsYXN0IGVsZW1lbnQgdG8gaW5jbHVkZSAoZXZlcnl0aGluZyBhZnRlclxuICAgICAgIyB0aGF0IHdpbGwgYmUgcmVtb3ZlZClcbiAgICAgIGxvd1dhdGVyID0gTWF0aC5taW4oc2Nyb2xsSGVpZ2h0LCBNYXRoLmFicyhlLnNjcm9sbFRvcCkgKyB2aWV3cG9ydEhlaWdodCArIEB2aXJ0dWFsQWRkVGhyZXNob2xkKVxuICAgICAgXG4gICAgICAjIENvbXB1dGUgaG93IG1hbnkgaXRlbXMgcGVyIHZpZXdwb3J0IHNpemUgY2FuIHNob3dcbiAgICAgIGl0ZW1zUGVyVmlld3BvcnQgPSBNYXRoLmZsb29yKChsb3dXYXRlciAtIGhpZ2hXYXRlcikgLyBpdGVtSGVpZ2h0KVxuICAgICAgXG4gICAgICAjIEdldCB0aGUgZmlyc3QgYW5kIGxhc3QgZWxlbWVudHMgaW4gdGhlIGxpc3QgYmFzZWQgb24gaG93IG1hbnkgY2FuIGZpdFxuICAgICAgIyBiZXR3ZWVuIHRoZSBwaXhlbCByYW5nZSBvZiBsb3dXYXRlciBhbmQgaGlnaFdhdGVyXG4gICAgICBmaXJzdCA9IHBhcnNlSW50KE1hdGguYWJzKGhpZ2hXYXRlciAvIGl0ZW1IZWlnaHQpLCAxMClcbiAgICAgIGxhc3QgPSBwYXJzZUludChNYXRoLmFicyhsb3dXYXRlciAvIGl0ZW1IZWlnaHQpLCAxMClcbiAgICAgIFxuICAgICAgIyBHZXQgdGhlIGl0ZW1zIHdlIG5lZWQgdG8gcmVtb3ZlXG4gICAgICBAX3ZpcnR1YWxJdGVtc1RvUmVtb3ZlID0gQXJyYXk6OnNsaWNlLmNhbGwoQGxpc3RFbC5jaGlsZHJlbiwgMCwgZmlyc3QpXG4gICAgICBcbiAgICAgICMgR3JhYiB0aGUgbm9kZXMgd2Ugd2lsbCBiZSBzaG93aW5nXG4gICAgICBub2RlcyA9IEFycmF5OjpzbGljZS5jYWxsKEBsaXN0RWwuY2hpbGRyZW4sIGZpcnN0LCBmaXJzdCArIGl0ZW1zUGVyVmlld3BvcnQpXG4gICAgICBAcmVuZGVyVmlld3BvcnQgYW5kIEByZW5kZXJWaWV3cG9ydChoaWdoV2F0ZXIsIGxvd1dhdGVyLCBmaXJzdCwgbGFzdClcbiAgICByZXR1cm5cblxuICBkaWRTdG9wU2Nyb2xsaW5nOiAoZSkgLT5cbiAgICBpZiBAaXNWaXJ0dWFsXG4gICAgICBpID0gMFxuXG4gICAgICB3aGlsZSBpIDwgQF92aXJ0dWFsSXRlbXNUb1JlbW92ZS5sZW5ndGhcbiAgICAgICAgZWwgPSBAX3ZpcnR1YWxJdGVtc1RvUmVtb3ZlW2ldXG4gICAgICAgIFxuICAgICAgICAjZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7XG4gICAgICAgIEBkaWRIaWRlSXRlbSBhbmQgQGRpZEhpZGVJdGVtKGkpXG4gICAgICAgIGkrK1xuICAgIHJldHVyblxuXG4gIFxuICAjIE9uY2Ugc2Nyb2xsaW5nIHN0b3BzLCBjaGVjayBpZiB3ZSBuZWVkIHRvIHJlbW92ZSBvbGQgaXRlbXNcbiAgXG4gICMjIypcbiAgQ2xlYXIgYW55IGFjdGl2ZSBkcmFnIGVmZmVjdHMgb24gdGhlIGxpc3QuXG4gICMjI1xuICBjbGVhckRyYWdFZmZlY3RzOiAtPlxuICAgIGlmIEBfbGFzdERyYWdPcFxuICAgICAgQF9sYXN0RHJhZ09wLmNsZWFuIGFuZCBAX2xhc3REcmFnT3AuY2xlYW4oKVxuICAgICAgQF9sYXN0RHJhZ09wID0gbnVsbFxuICAgIHJldHVyblxuXG4gIF9pbml0RHJhZzogLT5cbiAgICBcbiAgICAjaW9uaWMudmlld3MuTGlzdFZpZXcuX19zdXBlcl9fLl9pbml0RHJhZy5jYWxsKHRoaXMpO1xuICAgIFxuICAgICMgU3RvcmUgdGhlIGxhc3Qgb25lXG4gICAgQF9sYXN0RHJhZ09wID0gQF9kcmFnT3BcbiAgICBAX2RyYWdPcCA9IG51bGxcbiAgICByZXR1cm5cblxuICBcbiAgIyBSZXR1cm4gdGhlIGxpc3QgaXRlbSBmcm9tIHRoZSBnaXZlbiB0YXJnZXRcbiAgX2dldEl0ZW06ICh0YXJnZXQpIC0+XG4gICAgd2hpbGUgdGFyZ2V0XG4gICAgICByZXR1cm4gdGFyZ2V0ICBpZiB0YXJnZXQuY2xhc3NMaXN0IGFuZCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKElURU1fQ0xBU1MpXG4gICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZVxuICAgIG51bGxcblxuICBfc3RhcnREcmFnOiAoZSkgLT5cbiAgICBfdGhpcyA9IHRoaXNcbiAgICBkaWRTdGFydCA9IGZhbHNlXG4gICAgQF9pc0RyYWdnaW5nID0gZmFsc2VcbiAgICBsYXN0RHJhZ09wID0gQF9sYXN0RHJhZ09wXG4gICAgaXRlbSA9IHVuZGVmaW5lZFxuICAgIFxuICAgICMgQ2hlY2sgaWYgdGhpcyBpcyBhIHJlb3JkZXIgZHJhZ1xuICAgIGlmIGlvbmljLkRvbVV0aWwuZ2V0UGFyZW50T3JTZWxmV2l0aENsYXNzKGUudGFyZ2V0LCBJVEVNX1JFT1JERVJfQlROX0NMQVNTKSBhbmQgKGUuZ2VzdHVyZS5kaXJlY3Rpb24gaXMgXCJ1cFwiIG9yIGUuZ2VzdHVyZS5kaXJlY3Rpb24gaXMgXCJkb3duXCIpXG4gICAgICBpdGVtID0gQF9nZXRJdGVtKGUudGFyZ2V0KVxuICAgICAgaWYgaXRlbVxuICAgICAgICBAX2RyYWdPcCA9IG5ldyBSZW9yZGVyRHJhZyhcbiAgICAgICAgICBsaXN0RWw6IEBlbFxuICAgICAgICAgIGVsOiBpdGVtXG4gICAgICAgICAgc2Nyb2xsRWw6IEBzY3JvbGxFbFxuICAgICAgICAgIHNjcm9sbFZpZXc6IEBzY3JvbGxWaWV3XG4gICAgICAgICAgb25SZW9yZGVyOiAoZWwsIHN0YXJ0LCBlbmQpIC0+XG4gICAgICAgICAgICBfdGhpcy5vblJlb3JkZXIgYW5kIF90aGlzLm9uUmVvcmRlcihlbCwgc3RhcnQsIGVuZClcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICApXG4gICAgICAgIEBfZHJhZ09wLnN0YXJ0IGVcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgXG4gICAgIyBPciBjaGVjayBpZiB0aGlzIGlzIGEgc3dpcGUgdG8gdGhlIHNpZGUgZHJhZ1xuICAgIGVsc2UgaWYgbm90IEBfZGlkRHJhZ1VwT3JEb3duIGFuZCAoZS5nZXN0dXJlLmRpcmVjdGlvbiBpcyBcImxlZnRcIiBvciBlLmdlc3R1cmUuZGlyZWN0aW9uIGlzIFwicmlnaHRcIikgYW5kIE1hdGguYWJzKGUuZ2VzdHVyZS5kZWx0YVgpID4gNVxuICAgICAgXG4gICAgICAjIE1ha2Ugc3VyZSB0aGlzIGlzIGFuIGl0ZW0gd2l0aCBidXR0b25zXG4gICAgICBpdGVtID0gQF9nZXRJdGVtKGUudGFyZ2V0KVxuICAgICAgaWYgaXRlbSBhbmQgaXRlbS5xdWVyeVNlbGVjdG9yKFwiLml0ZW0tb3B0aW9uc1wiKVxuICAgICAgICBAX2RyYWdPcCA9IG5ldyBTbGlkZURyYWcoXG4gICAgICAgICAgZWw6IEBlbFxuICAgICAgICAgIGNhblN3aXBlOiBAY2FuU3dpcGVcbiAgICAgICAgKVxuICAgICAgICBAX2RyYWdPcC5zdGFydCBlXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIFxuICAgICMgSWYgd2UgaGFkIGEgbGFzdCBkcmFnIG9wZXJhdGlvbiBhbmQgdGhpcyBpcyBhIG5ldyBvbmUgb24gYSBkaWZmZXJlbnQgaXRlbSwgY2xlYW4gdGhhdCBsYXN0IG9uZVxuICAgIGxhc3REcmFnT3AuY2xlYW4gYW5kIGxhc3REcmFnT3AuY2xlYW4oKSAgaWYgbGFzdERyYWdPcCBhbmQgQF9kcmFnT3AgYW5kIG5vdCBAX2RyYWdPcC5pc1NhbWVJdGVtKGxhc3REcmFnT3ApIGFuZCBlLmRlZmF1bHRQcmV2ZW50ZWRcbiAgICByZXR1cm5cblxuICBfaGFuZGxlRW5kRHJhZzogKGUpIC0+XG4gICAgX3RoaXMgPSB0aGlzXG4gICAgQF9kaWREcmFnVXBPckRvd24gPSBmYWxzZVxuICAgIFxuICAgICNpb25pYy52aWV3cy5MaXN0Vmlldy5fX3N1cGVyX18uX2hhbmRsZUVuZERyYWcuY2FsbCh0aGlzLCBlKTtcbiAgICByZXR1cm4gIHVubGVzcyBAX2RyYWdPcFxuICAgIEBfZHJhZ09wLmVuZCBlLCAtPlxuICAgICAgX3RoaXMuX2luaXREcmFnKClcbiAgICAgIHJldHVyblxuXG4gICAgcmV0dXJuXG5cbiAgXG4gICMjIypcbiAgUHJvY2VzcyB0aGUgZHJhZyBldmVudCB0byBtb3ZlIHRoZSBpdGVtIHRvIHRoZSBsZWZ0IG9yIHJpZ2h0LlxuICAjIyNcbiAgX2hhbmRsZURyYWc6IChlKSAtPlxuICAgIF90aGlzID0gdGhpc1xuICAgIGNvbnRlbnQgPSB1bmRlZmluZWRcbiAgICBidXR0b25zID0gdW5kZWZpbmVkXG4gICAgQF9kaWREcmFnVXBPckRvd24gPSB0cnVlICBpZiBNYXRoLmFicyhlLmdlc3R1cmUuZGVsdGFZKSA+IDVcbiAgICBcbiAgICAjIElmIHdlIGdldCBhIGRyYWcgZXZlbnQsIG1ha2Ugc3VyZSB3ZSBhcmVuJ3QgaW4gYW5vdGhlciBkcmFnLCB0aGVuIGNoZWNrIGlmIHdlIHNob3VsZFxuICAgICMgc3RhcnQgb25lXG4gICAgQF9zdGFydERyYWcgZSAgaWYgbm90IEBpc0RyYWdnaW5nIGFuZCBub3QgQF9kcmFnT3BcbiAgICBcbiAgICAjIE5vIGRyYWcgc3RpbGwsIHBhc3MgaXQgdXBcbiAgICBcbiAgICAjaW9uaWMudmlld3MuTGlzdFZpZXcuX19zdXBlcl9fLl9oYW5kbGVEcmFnLmNhbGwodGhpcywgZSk7XG4gICAgcmV0dXJuICB1bmxlc3MgQF9kcmFnT3BcbiAgICBlLmdlc3R1cmUuc3JjRXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIEBfZHJhZ09wLmRyYWcgZVxuICAgIHJldHVyblxuKSIsImFuZ3VsYXIubW9kdWxlKCdpb25pYy5jb250cmliLlRyZWVWaWV3JykuZGlyZWN0aXZlIFwidHJlZUl0ZW1cIiwgW1xuICBcIiRhbmltYXRlXCJcbiAgXCIkY29tcGlsZVwiXG4gICgkYW5pbWF0ZSwgJGNvbXBpbGUpIC0+XG4gICAgcmV0dXJuIChcbiAgICAgIHJlc3RyaWN0OiBcIkVcIlxuICAgICAgY29udHJvbGxlcjogW1xuICAgICAgICBcIiRzY29wZVwiXG4gICAgICAgIFwiJGVsZW1lbnRcIlxuICAgICAgICAoJHNjb3BlLCAkZWxlbWVudCkgLT5cbiAgICAgICAgICAkc2NvcGUudG9nZ2xlID0gKCRldmVudCwgcm93KSAtPlxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgICAgICByb3cuaXRlbS5leHBhbmRlZCA9ICFyb3cuaXRlbS5leHBhbmRlZFxuICAgICAgICAgICAgJHNjb3BlLm9uRXhwYW5kQ2hhbmdlKHsgcm93OiByb3cgfSlcblxuICAgICAgICAgICRzY29wZS5jaGVja2JveENsaWNrID0gKCRldmVudCwgcm93KSAtPlxuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgICAgICAjIHRvZG86IGNvbmZpZ3VyYWJsZVxuICAgICAgICAgICAgcm93Lml0ZW0uZG9uZSA9ICFyb3cuaXRlbS5kb25lXG4gICAgICAgICAgICAkc2NvcGUub25DaGVja2JveENoYW5nZSh7IHJvdzogcm93IH0pXG5cbiAgICAgICAgICAkc2NvcGUucm93Q2xpY2sgPSAocm93KSAtPlxuICAgICAgICAgICAgJHNjb3BlLm9uQ2xpY2soeyByb3c6IHJvdyB9KVxuICAgICAgXVxuICAgICAgY29tcGlsZTogKCRlbGVtZW50LCAkYXR0cnMpIC0+XG4gICAgICAgICRlbGVtZW50LmFkZENsYXNzIFwiaXRlbSBpdGVtLWNvbXBsZXggdHJlZS1pdGVtXCJcblxuICAgICAgICBsaW5rID0gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycykgLT5cbiAgICAgICAgICAkc2NvcGUuZ2V0VHJlZVBhZGRpbmcgPSAocm93KSAtPlxuICAgICAgICAgICAgcGFkZGluZyA9IHJvdy5sZXZlbCAqIDQwXG4gICAgICAgICAgICByZXR1cm4geyAncGFkZGluZy1sZWZ0JzogcGFkZGluZyArICdweCcgfVxuICAgICAgICAgIFxuICAgICAgICAgICRzY29wZS5nZXRWaXNpYmlsaXR5ID0gKHJvdykgLT5cbiAgICAgICAgICAgIGlmIHJvdy5pdGVtLmhpZGVFeHBhbmRlclxuICAgICAgICAgICAgICByZXR1cm4gJ2hpZGRlbidcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgaWYgcm93Lml0ZW0uY2hpbGRyZW4/Lmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAndmlzaWJsZSdcbiAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICdoaWRkZW4nXG5cbiMgICAgICAgICAgaWYgJHNjb3BlLnNob3dOdW1iZXJzXG4jICAgICAgICAgIHRyZWVJdGVtTnVtYmVyQ2xhc3MgPSBcInRyZWUtaXRlbS13aXRoLW51bWJlclwiXG4gICAgICAgICAgbnVtYmVyID0gYW5ndWxhci5lbGVtZW50KFwiPHNwYW4gbmctaWY9XFxcInNob3dOdW1iZXJzXFxcIiBjbGFzcz1cXFwidHJlZS1pdGVtLW51bWJlclxcXCI+e3tyb3cubnVtYmVyLmpvaW4oJy4nKX19Ojwvc3Bhbj5cIilcbiMgICAgICAgICAgZWxzZVxuIyAgICAgICAgICAgIHRyZWVJdGVtTnVtYmVyQ2xhc3MgPSBcIlwiXG5cbiMgICAgICAgICAgc2hvd0NoZWNrYm94ID0gJHNjb3BlLnJvdy5zaG93Q2hlY2tib3ggfHwgKCRzY29wZS5zaG93Q2hlY2tib3hlcyAmJiAkc2NvcGUucm93LnNob3dDaGVja2JveCAhPSBmYWxzZSlcbiMgICAgICAgICAgaWYgc2hvd0NoZWNrYm94XG4jICAgICAgICAgICAgdHJlZUl0ZW1DaGVja2JveENsYXNzID0gXCJ0cmVlLWl0ZW0td2l0aC1jaGVja2JveFwiXG4jICAgICAgICAgIGNoZWNrYm94ID0gYW5ndWxhci5lbGVtZW50KFwiPGxhYmVsXG4jICAgICAgICAgICAgbmctaWY9XFxcInJvdy5zaG93Q2hlY2tib3ggfHwgKHNob3dDaGVja2JveGVzICYmIHJvdy5zaG93Q2hlY2tib3ggIT09IGZhbHNlKVxcXCJcbiMgICAgICAgICAgICBjbGFzcz1cXFwiY2hlY2tib3hcXFwiPjxpbnB1dCB0eXBlPVxcXCJjaGVja2JveFxcXCIgbmctY2hlY2tlZD1cXFwicm93Lml0ZW0uZG9uZVxcXCIgXG4jICAgICAgICAgICAgbmctY2xpY2s9XFxcImNoZWNrYm94Q2xpY2soJGV2ZW50LCByb3cpXFxcIj5cbiMgICAgICAgICAgICA8L2xhYmVsPlwiIykgXG4gICAgICAgICAgY2hlY2tib3ggPSBhbmd1bGFyLmVsZW1lbnQoXCI8bGFiZWwgXG4gICAgICAgICAgICAgIG5nLWlmPVxcXCIhKHJvdy5zaG93Q2hlY2tib3ggfHwgKHNob3dDaGVja2JveGVzICYmIHJvdy5zaG93Q2hlY2tib3ggIT09IGZhbHNlKSlcXFwiXG4gICAgICAgICAgICAgIHN0eWxlPVxcXCJoZWlnaHQ6IDI4cHg7IHdpZHRoOiAxcHg7IGZsb2F0OiBsZWZ0OyBwYWRkaW5nLWxlZnQ6IDNweDtcXFwiPjwvbGFiZWw+XG4gICAgICAgICAgICAgIDxsYWJlbCBuZy1pZj1cXFwicm93LnNob3dDaGVja2JveCB8fCAoc2hvd0NoZWNrYm94ZXMgJiYgcm93LnNob3dDaGVja2JveCAhPT0gZmFsc2UpXFxcIiBcbiAgICAgICAgICAgICAgICBjbGFzcz1cXFwiY2hlY2tib3hcXFwiPjxpbnB1dCB0eXBlPVxcXCJjaGVja2JveFxcXCIgbmctY2hlY2tlZD1cXFwicm93Lml0ZW0uZG9uZVxcXCIgbmctY2xpY2s9XFxcImNoZWNrYm94Q2xpY2soJGV2ZW50LCByb3cpXFxcIj5cbiAgICAgICAgICAgIDwvbGFiZWw+XCIpXG4jICAgICAgICAgIGVsc2VcbiMgICAgICAgICAgICB0cmVlSXRlbUNoZWNrYm94Q2xhc3MgPSBcIlwiXG5cbiAgICAgICAgICAjIGB0cnVlYCBpbnN0ZWFkIG9mIGByb3cuc2hvd0NoZWNrYm94IHx8IChzaG93Q2hlY2tib3hlcyAmJiByb3cuc2hvd0NoZWNrYm94ICE9PSBmYWxzZSlgXG4gICAgICAgICAgIyBpdCdzIGp1c3QgZGF5cyBiZWZvcmUgcmVsZWFzZSwgQ1NTIGlzIHNldCB0aGlzIHdheSByaWdodCBub3csIC4uLlxuICAgICAgICAgICMgbGV0J3MgbGVhdmUgaXQgYXMgaXQgaXMgZm9yIG5vdy4gVGhlIHByb2JsZW0gaXMgdGhhdCBjbGFzcyB0cmVlLWl0ZW0td2l0aC1jaGVja2JveFxuICAgICAgICAgICMgd2lsbCBiZSB0aGVyZSBldmVuIGZvciBlbGVtZW50cyBXSVRIT1VUIGNoZWNrYm94ZXMgLSBuZWVkcyByZWZhY3RvcmluZ1xuICAgICAgICAgIGNvbnRhaW5lckxpbmsgPSBhbmd1bGFyLmVsZW1lbnQoXCI8YSBcbiAgICAgICAgICAgIGNsYXNzPVxcXCJpdGVtLWNvbnRlbnQgaXRlbS1pY29uLXJpZ2h0XFxcIiBcbiAgICAgICAgICAgIG5nLWNsYXNzPVxcXCJ7J3RyZWUtaXRlbS13aXRoLW51bWJlcic6IHNob3dOdW1iZXJzLCAndHJlZS1pdGVtLXdpdGgtY2hlY2tib3gnOiB0cnVlfVxcXCJcbiAgICAgICAgICAgIG5nLWNsaWNrPVxcXCJyb3dDbGljayhyb3cpXFxcIlxuICAgICAgICAgICAgbmctc3R5bGU9XFxcImdldFRyZWVQYWRkaW5nKHJvdylcXFwiXG4gICAgICAgICAgICA+PC9hPlwiKVxuXG4gICAgICAgICAgY2hldnJvbiA9IGFuZ3VsYXIuZWxlbWVudChcIjxhIGNsYXNzPVxcXCJleHBhbmQtYnV0dG9uIGljb24gaW9uLWNoZXZyb24tZG93blxcXCIgXG4gICAgICAgICAgICBuZy1jbGFzcz1cXFwieyd0cmVlLWl0ZW0tZXhwYW5kZWQnOiByb3cuaXRlbS5leHBhbmRlZH1cXFwiIFxuICAgICAgICAgICAgbmctc3R5bGU9XFxcInsndmlzaWJpbGl0eSc6IGdldFZpc2liaWxpdHkocm93KX1cXFwiXG4gICAgICAgICAgICBuZy1jbGljaz1cXFwidG9nZ2xlKCRldmVudCwgcm93KVxcXCI+PC9hPlwiKVxuXG4gICAgICAgICAgdGV4dENvbnRhaW5lciA9IGFuZ3VsYXIuZWxlbWVudChcIjxzcGFuIGNsYXNzPVxcXCJ0cmVlLWl0ZW0tdGV4dFxcXCI+PC9zcGFuPlwiKVxuXG4gICAgICAgICAgdGV4dENvbnRhaW5lci5hcHBlbmQgJGVsZW1lbnQuY29udGVudHMoKVxuXG4jICAgICAgICAgIGlmICRzY29wZS5zaG93TnVtYmVyc1xuICAgICAgICAgIGNvbnRhaW5lckxpbmsuYXBwZW5kKG51bWJlcilcbiAgICAgICAgICBcbiAgICAgICAgICBjb250YWluZXJMaW5rLmFwcGVuZChjaGVja2JveClcbiAgICAgICAgICBcbiAgICAgICAgICBjb250YWluZXJMaW5rLmFwcGVuZCh0ZXh0Q29udGFpbmVyKS5hcHBlbmQoY2hldnJvbilcblxuICAgICAgICAgICRlbGVtZW50LmFwcGVuZCBjb250YWluZXJMaW5rXG4gICAgICAgICAgJGNvbXBpbGUoY29udGFpbmVyTGluaykoJHNjb3BlKVxuXG4gICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgcmV0dXJuIGxpbmtcbiAgICApXG5dIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9