angular.module('ionic.contrib.TreeView', ['ionic']).directive("treeView", [
  "$animate", "$compile", "$timeout", function($animate, $compile, $timeout) {
    return {
      restrict: "E",
      require: ["^?$ionicScroll"],
      template: "<tree-item ng-repeat=\"row in treeRows | filter:{visible:true} track by row.item.id\" row=\"row\">{{row.item.name}}</tree-item>",
      scope: {
        onExpandChange: '&',
        onCheckboxChange: '&',
        onClick: '&',
        items: '=',
        showCheckboxes: '=',
        showNumbers: '='
      },
      compile: function($element, $attr) {
        var listEl;
        listEl = angular.element("<div class=\"tree-view list\">").append($element.contents());
        $element.append(listEl);
        return function($scope, $element, $attrs, ctrls) {
          var buildTreeRows, init;
          buildTreeRows = function(items, level, number, visible) {
            var childrenVisible, index, item, row, rowNumber, _i, _len, _ref, _results;
            if ($attrs.scrollHeight) {
              if ((_ref = $element.parent()[0]) != null) {
                _ref.style.height = $attrs.scrollHeight;
              }
            }
            if (!number) {
              number = [];
            }
            _results = [];
            for (index = _i = 0, _len = items.length; _i < _len; index = ++_i) {
              item = items[index];
              rowNumber = number.slice();
              rowNumber.push(index + 1);
              row = {
                item: item,
                level: level,
                number: rowNumber,
                showCheckbox: item.showCheckbox
              };
              if (item.visible === false) {
                row.visible = item.visible;
              } else {
                row.visible = visible;
              }
              $scope.treeRows.push(row);
              childrenVisible = visible && item.expanded;
              if (item.children) {
                _results.push(buildTreeRows(item.children, level + 1, rowNumber, childrenVisible));
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          };
          init = function() {
            $scope.treeRows = [];
            return buildTreeRows($scope.items, 0, null, true);
          };
          $scope.$watch('items', init, true);
        };
      }
    };
  }
]);

angular.module('ionic.contrib.TreeView').controller("$treeView", ["$scope", "$attrs", "$parse", function($scope, $attrs, $parse) {}]);

var TreeView;

TreeView = ionic.views.View.inherit({
  initialize: function(opts) {
    var _this;
    return;
    _this = this;
    opts = ionic.extend({
      onReorder: function(el, oldIndex, newIndex) {},
      virtualRemoveThreshold: -200,
      virtualAddThreshold: 200,
      canSwipe: function() {
        return true;
      }
    }, opts);
    ionic.extend(this, opts);
    if (!this.itemHeight && this.listEl) {
      this.itemHeight = this.listEl.children[0] && parseInt(this.listEl.children[0].style.height, 10);
    }
    this.onRefresh = opts.onRefresh || function() {};
    this.onRefreshOpening = opts.onRefreshOpening || function() {};
    this.onRefreshHolding = opts.onRefreshHolding || function() {};
    window.ionic.onGesture("release", (function(e) {
      _this._handleEndDrag(e);
    }), this.el);
    window.ionic.onGesture("drag", (function(e) {
      _this._handleDrag(e);
    }), this.el);
    this._initDrag();
  },

  /**
  Called to tell the list to stop refreshing. This is useful
  if you are refreshing the list and are done with refreshing.
   */
  stopRefreshing: function() {
    var refresher;
    refresher = this.el.querySelector(".list-refresher");
    refresher.style.height = "0px";
  },

  /**
  If we scrolled and have virtual mode enabled, compute the window
  of active elements in order to figure out the viewport to render.
   */
  didScroll: function(e) {
    var first, highWater, itemHeight, itemsPerViewport, last, lowWater, nodes, scrollHeight, scrollTop, totalItems, viewportHeight;
    if (this.isVirtual) {
      itemHeight = this.itemHeight;
      totalItems = this.listEl.children.length;
      scrollHeight = e.target.scrollHeight;
      viewportHeight = this.el.parentNode.offsetHeight;
      scrollTop = e.scrollTop;
      highWater = Math.max(0, e.scrollTop + this.virtualRemoveThreshold);
      lowWater = Math.min(scrollHeight, Math.abs(e.scrollTop) + viewportHeight + this.virtualAddThreshold);
      itemsPerViewport = Math.floor((lowWater - highWater) / itemHeight);
      first = parseInt(Math.abs(highWater / itemHeight), 10);
      last = parseInt(Math.abs(lowWater / itemHeight), 10);
      this._virtualItemsToRemove = Array.prototype.slice.call(this.listEl.children, 0, first);
      nodes = Array.prototype.slice.call(this.listEl.children, first, first + itemsPerViewport);
      this.renderViewport && this.renderViewport(highWater, lowWater, first, last);
    }
  },
  didStopScrolling: function(e) {
    var el, i;
    if (this.isVirtual) {
      i = 0;
      while (i < this._virtualItemsToRemove.length) {
        el = this._virtualItemsToRemove[i];
        this.didHideItem && this.didHideItem(i);
        i++;
      }
    }
  },

  /**
  Clear any active drag effects on the list.
   */
  clearDragEffects: function() {
    if (this._lastDragOp) {
      this._lastDragOp.clean && this._lastDragOp.clean();
      this._lastDragOp = null;
    }
  },
  _initDrag: function() {
    this._lastDragOp = this._dragOp;
    this._dragOp = null;
  },
  _getItem: function(target) {
    while (target) {
      if (target.classList && target.classList.contains(ITEM_CLASS)) {
        return target;
      }
      target = target.parentNode;
    }
    return null;
  },
  _startDrag: function(e) {
    var didStart, item, lastDragOp, _this;
    _this = this;
    didStart = false;
    this._isDragging = false;
    lastDragOp = this._lastDragOp;
    item = void 0;
    if (ionic.DomUtil.getParentOrSelfWithClass(e.target, ITEM_REORDER_BTN_CLASS) && (e.gesture.direction === "up" || e.gesture.direction === "down")) {
      item = this._getItem(e.target);
      if (item) {
        this._dragOp = new ReorderDrag({
          listEl: this.el,
          el: item,
          scrollEl: this.scrollEl,
          scrollView: this.scrollView,
          onReorder: function(el, start, end) {
            _this.onReorder && _this.onReorder(el, start, end);
          }
        });
        this._dragOp.start(e);
        e.preventDefault();
      }
    } else if (!this._didDragUpOrDown && (e.gesture.direction === "left" || e.gesture.direction === "right") && Math.abs(e.gesture.deltaX) > 5) {
      item = this._getItem(e.target);
      if (item && item.querySelector(".item-options")) {
        this._dragOp = new SlideDrag({
          el: this.el,
          canSwipe: this.canSwipe
        });
        this._dragOp.start(e);
        e.preventDefault();
      }
    }
    if (lastDragOp && this._dragOp && !this._dragOp.isSameItem(lastDragOp) && e.defaultPrevented) {
      lastDragOp.clean && lastDragOp.clean();
    }
  },
  _handleEndDrag: function(e) {
    var _this;
    _this = this;
    this._didDragUpOrDown = false;
    if (!this._dragOp) {
      return;
    }
    this._dragOp.end(e, function() {
      _this._initDrag();
    });
  },

  /**
  Process the drag event to move the item to the left or right.
   */
  _handleDrag: function(e) {
    var buttons, content, _this;
    _this = this;
    content = void 0;
    buttons = void 0;
    if (Math.abs(e.gesture.deltaY) > 5) {
      this._didDragUpOrDown = true;
    }
    if (!this.isDragging && !this._dragOp) {
      this._startDrag(e);
    }
    if (!this._dragOp) {
      return;
    }
    e.gesture.srcEvent.preventDefault();
    this._dragOp.drag(e);
  }
});

angular.module('ionic.contrib.TreeView').directive("treeItem", [
  "$animate", "$compile", function($animate, $compile) {
    return {
      restrict: "E",
      controller: [
        "$scope", "$element", function($scope, $element) {
          $scope.toggle = function($event, row) {
            $event.stopPropagation();
            row.item.expanded = !row.item.expanded;
            return $scope.onExpandChange({
              row: row
            });
          };
          $scope.checkboxClick = function($event, row) {
            $event.stopPropagation();
            row.item.done = !row.item.done;
            return $scope.onCheckboxChange({
              row: row
            });
          };
          return $scope.rowClick = function(row) {
            return $scope.onClick({
              row: row
            });
          };
        }
      ],
      compile: function($element, $attrs) {
        var link;
        $element.addClass("item item-complex tree-item");
        link = function($scope, $element, $attrs) {
          var checkbox, chevron, containerLink, number, showCheckbox, textContainer, treeItemCheckboxClass, treeItemNumberClass;
          $scope.getTreePadding = function(row) {
            var padding;
            padding = row.level * 40;
            return {
              'padding-left': padding + 'px'
            };
          };
          $scope.getVisibility = function(row) {
            var _ref;
            if (row.item.hideExpander) {
              return 'hidden';
            } else {
              if (((_ref = row.item.children) != null ? _ref.length : void 0) > 0) {
                return 'visible';
              } else {
                return 'hidden';
              }
            }
          };
          if ($scope.showNumbers) {
            treeItemNumberClass = "tree-item-with-number";
            number = angular.element("<span class=\"tree-item-number\">" + ($scope.row.number.join('.')) + ":</span>");
          } else {
            treeItemNumberClass = "";
          }
          showCheckbox = $scope.row.showCheckbox || ($scope.showCheckboxes && $scope.row.showCheckbox !== false);
          if (showCheckbox) {
            treeItemCheckboxClass = "tree-item-with-checkbox";
            checkbox = angular.element("<label class=\"checkbox\"><input type=\"checkbox\" ng-checked=\"row.item.done\" ng-click=\"checkboxClick($event, row)\"></label>");
          } else {
            treeItemCheckboxClass = "";
          }
          containerLink = angular.element("<a class=\"item-content item-icon-right " + treeItemCheckboxClass + " " + treeItemNumberClass + "\" ng-click=\"rowClick(row)\" ng-style=\"getTreePadding(row)\" ></a>");
          chevron = angular.element("<a class=\"expand-button icon ion-chevron-down\" ng-class=\"{'tree-item-expanded': row.item.expanded}\" ng-style=\"{'visibility': getVisibility(row)}\" ng-click=\"toggle($event, row)\"></a>");
          textContainer = angular.element("<span class=\"tree-item-text\"></span>");
          textContainer.append($element.contents());
          if ($scope.showNumbers) {
            containerLink.append(number);
          }
          if (showCheckbox) {
            containerLink.append(checkbox);
          }
          containerLink.append(textContainer).append(chevron);
          $element.append(containerLink);
          $compile(containerLink)($scope);
        };
        return link;
      }
    };
  }
]);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyZWVfdmlld19kaXJlY3RpdmUuY29mZmVlIiwidHJlZV92aWV3X2NvbnRyb2xsZXIuY29mZmVlIiwidHJlZV92aWV3X3ZpZXcuY29mZmVlIiwidHJlZV9pdGVtX2RpcmVjdGl2ZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxDQUFDLE1BQVIsQ0FBZSx3QkFBZixFQUF5QyxDQUFDLE9BQUQsQ0FBekMsQ0FDQSxDQUFDLFNBREQsQ0FDVyxVQURYLEVBQ3VCO0VBQ3JCLFVBRHFCLEVBRXJCLFVBRnFCLEVBR3JCLFVBSHFCLEVBSXJCLFNBQUMsUUFBRCxFQUFXLFFBQVgsRUFBcUIsUUFBckIsR0FBQTtBQUNFLFdBQ0U7QUFBQSxNQUFBLFFBQUEsRUFBVSxHQUFWO0FBQUEsTUFDQSxPQUFBLEVBQVMsQ0FDUCxnQkFETyxDQURUO0FBQUEsTUFLQSxRQUFBLEVBQVUsaUlBTFY7QUFBQSxNQU9BLEtBQUEsRUFDRTtBQUFBLFFBQUEsY0FBQSxFQUFnQixHQUFoQjtBQUFBLFFBQ0EsZ0JBQUEsRUFBa0IsR0FEbEI7QUFBQSxRQUVBLE9BQUEsRUFBUyxHQUZUO0FBQUEsUUFHQSxLQUFBLEVBQU8sR0FIUDtBQUFBLFFBSUEsY0FBQSxFQUFnQixHQUpoQjtBQUFBLFFBS0EsV0FBQSxFQUFhLEdBTGI7T0FSRjtBQUFBLE1BY0EsT0FBQSxFQUFTLFNBQUMsUUFBRCxFQUFXLEtBQVgsR0FBQTtBQUNQLFlBQUEsTUFBQTtBQUFBLFFBQUEsTUFBQSxHQUFTLE9BQU8sQ0FBQyxPQUFSLENBQWdCLGdDQUFoQixDQUFpRCxDQUFDLE1BQWxELENBQXlELFFBQVEsQ0FBQyxRQUFULENBQUEsQ0FBekQsQ0FBVCxDQUFBO0FBQUEsUUFDQSxRQUFRLENBQUMsTUFBVCxDQUFnQixNQUFoQixDQURBLENBQUE7ZUFHQSxTQUFDLE1BQUQsRUFBUyxRQUFULEVBQW1CLE1BQW5CLEVBQTJCLEtBQTNCLEdBQUE7QUFFRSxjQUFBLG1CQUFBO0FBQUEsVUFBQSxhQUFB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LE9BQVIsQ0FBZ0Isd0NBQWhCLENBdENoQixDQUFBO0FBQUEsVUF3Q0EsYUFBYSxDQUFDLE1BQWQsQ0FBcUIsUUFBUSxDQUFDLFFBQVQsQ0FBQSxDQUFyQixDQXhDQSxDQUFBO0FBMENBLFVBQUEsSUFBRyxNQUFNLENBQUMsV0FBVjtBQUNFLFlBQUEsYUFBYSxDQUFDLE1BQWQsQ0FBcUIsTUFBckIsQ0FBQSxDQURGO1dBMUNBO0FBNkNBLFVBQUEsSUFBRyxZQUFIO0FBQ0UsWUFBQSxhQUFhLENBQUMsTUFBZCxDQUFxQixRQUFyQixDQUFBLENBREY7V0E3Q0E7QUFBQSxVQWdEQSxhQUFhLENBQUMsTUFBZCxDQUFxQixhQUFyQixDQUFtQyxDQUFDLE1BQXBDLENBQTJDLE9BQTNDLENBaERBLENBQUE7QUFBQSxVQWtEQSxRQUFRLENBQUMsTUFBVCxDQUFnQixhQUFoQixDQWxEQSxDQUFBO0FBQUEsVUFtREEsUUFBQSxDQUFTLGFBQVQsQ0FBQSxDQUF3QixNQUF4QixDQW5EQSxDQURLO1FBQUEsQ0FGUCxDQUFBO0FBMERBLGVBQU8sSUFBUCxDQTNETztNQUFBLENBbkJUO0tBREYsQ0FERjtFQUFBLENBSDZEO0NBQS9ELENBQUEsQ0FBQSIsImZpbGUiOiJpb25pYy5jb250cmliLnRyZWV2aWV3LmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2lvbmljLmNvbnRyaWIuVHJlZVZpZXcnLCBbJ2lvbmljJ10pXG4uZGlyZWN0aXZlIFwidHJlZVZpZXdcIiwgW1xuICBcIiRhbmltYXRlXCJcbiAgXCIkY29tcGlsZVwiXG4gIFwiJHRpbWVvdXRcIlxuICAoJGFuaW1hdGUsICRjb21waWxlLCAkdGltZW91dCkgLT5cbiAgICByZXR1cm4gKFxuICAgICAgcmVzdHJpY3Q6IFwiRVwiXG4gICAgICByZXF1aXJlOiBbXG4gICAgICAgIFwiXj8kaW9uaWNTY3JvbGxcIlxuICAgICAgXVxuICAgICAgI2NvbnRyb2xsZXI6IFwiJHRyZWVWaWV3XCJcbiAgICAgIHRlbXBsYXRlOiBcIjx0cmVlLWl0ZW0gXG4gICAgICAgIG5nLXJlcGVhdD1cXFwicm93IGluIHRyZWVSb3dzIHwgZmlsdGVyOnt2aXNpYmxlOnRydWV9IHRyYWNrIGJ5IHJvdy5pdGVtLmlkXFxcIiByb3c9XFxcInJvd1xcXCI+e3tyb3cuaXRlbS5uYW1lfX08L3RyZWUtaXRlbT5cIlxuICAgICAgc2NvcGU6IFxuICAgICAgICBvbkV4cGFuZENoYW5nZTogJyYnXG4gICAgICAgIG9uQ2hlY2tib3hDaGFuZ2U6ICcmJ1xuICAgICAgICBvbkNsaWNrOiAnJidcbiAgICAgICAgaXRlbXM6ICc9J1xuICAgICAgICBzaG93Q2hlY2tib3hlczogJz0nXG4gICAgICAgIHNob3dOdW1iZXJzOiAnPSdcbiAgICAgIGNvbXBpbGU6ICgkZWxlbWVudCwgJGF0dHIpIC0+XG4gICAgICAgIGxpc3RFbCA9IGFuZ3VsYXIuZWxlbWVudChcIjxkaXYgY2xhc3M9XFxcInRyZWUtdmlldyBsaXN0XFxcIj5cIikuYXBwZW5kKCRlbGVtZW50LmNvbnRlbnRzKCkpXG4gICAgICAgICRlbGVtZW50LmFwcGVuZCBsaXN0RWxcbiAgICAgICAgXG4gICAgICAgICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsIGN0cmxzKSAtPlxuXG4gICAgICAgICAgYnVpbGRUcmVlUm93cyA9IChpdGVtcywgbGV2ZWwsIG51bWJlciwgdmlzaWJsZSkgLT5cbiAgICAgICAgICAgICMgc2V0IGN1c3RvbSBcbiAgICAgICAgICAgIGlmICRhdHRycy5zY3JvbGxIZWlnaHRcbiAgICAgICAgICAgICAgJGVsZW1lbnQucGFyZW50KClbMF0/LnN0eWxlLmhlaWdodCA9ICRhdHRycy5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG51bWJlciA9IFtdIHVubGVzcyBudW1iZXJcbiAgICAgICAgICAgIGZvciBpdGVtLCBpbmRleCBpbiBpdGVtc1xuICAgICAgICAgICAgICByb3dOdW1iZXIgPSBudW1iZXIuc2xpY2UoKVxuICAgICAgICAgICAgICByb3dOdW1iZXIucHVzaCBpbmRleCArIDFcbiAgICAgICAgICAgICAgcm93ID1cbiAgICAgICAgICAgICAgICBpdGVtOiBpdGVtXG4gICAgICAgICAgICAgICAgbGV2ZWw6IGxldmVsXG4gICAgICAgICAgICAgICAgbnVtYmVyOiByb3dOdW1iZXJcbiAgICAgICAgICAgICAgICBzaG93Q2hlY2tib3g6IGl0ZW0uc2hvd0NoZWNrYm94XG4gICAgICAgICAgICAgIGlmIGl0ZW0udmlzaWJsZSA9PSBmYWxzZVxuICAgICAgICAgICAgICAgIHJvdy52aXNpYmxlID0gaXRlbS52aXNpYmxlXG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByb3cudmlzaWJsZSA9IHZpc2libGVcbiAgICAgICAgICAgICAgJHNjb3BlLnRyZWVSb3dzLnB1c2ggcm93XG4gICAgICAgICAgICAgIGNoaWxkcmVuVmlzaWJsZSA9IHZpc2libGUgYW5kIGl0ZW0uZXhwYW5kZWRcbiAgICAgICAgICAgICAgYnVpbGRUcmVlUm93cyBpdGVtLmNoaWxkcmVuLCBsZXZlbCArIDEsIHJvd051bWJlciwgY2hpbGRyZW5WaXNpYmxlIGlmIGl0ZW0uY2hpbGRyZW5cblxuICAgICAgICAgIGluaXQgPSAtPlxuICAgICAgICAgICAgJHNjb3BlLnRyZWVSb3dzID0gW11cbiAgICAgICAgICAgIGJ1aWxkVHJlZVJvd3MgJHNjb3BlLml0ZW1zLCAwLCBudWxsLCB0cnVlXG5cbiAgICAgICAgICAkc2NvcGUuJHdhdGNoICdpdGVtcycsIGluaXQsIHRydWVcblxuICAgICAgICAgICAgI2xpc3RFbC5hcHBlbmQgJGNvbXBpbGUoYW5ndWxhci5lbGVtZW50KFwiPHRyZWUtaXRlbT4je2l0ZW0ubmFtZX08L3RyZWUtaXRlbT5cIiksIGl0ZW0pKCRzY29wZSlcblxuICAgICAgICAgICMkdGltZW91dCBpbml0XG5cbiAgICAgICAgICByZXR1cm5cbiAgICApXG5dIiwiYW5ndWxhci5tb2R1bGUoJ2lvbmljLmNvbnRyaWIuVHJlZVZpZXcnKVxuLmNvbnRyb2xsZXIgXCIkdHJlZVZpZXdcIiwgW1xuICBcIiRzY29wZVwiXG4gIFwiJGF0dHJzXCJcbiAgXCIkcGFyc2VcIlxuICAoJHNjb3BlLCAkYXR0cnMsICRwYXJzZSkgLT5cbiAgICBcbiAgICByZXR1cm5cbl0iLCJUcmVlVmlldyA9IGlvbmljLnZpZXdzLlZpZXcuaW5oZXJpdChcbiAgaW5pdGlhbGl6ZTogKG9wdHMpIC0+XG4gICAgcmV0dXJuXG5cbiAgICBfdGhpcyA9IHRoaXNcbiAgICBvcHRzID0gaW9uaWMuZXh0ZW5kKFxuICAgICAgb25SZW9yZGVyOiAoZWwsIG9sZEluZGV4LCBuZXdJbmRleCkgLT5cblxuICAgICAgdmlydHVhbFJlbW92ZVRocmVzaG9sZDogLTIwMFxuICAgICAgdmlydHVhbEFkZFRocmVzaG9sZDogMjAwXG4gICAgICBjYW5Td2lwZTogLT5cbiAgICAgICAgdHJ1ZVxuICAgICwgb3B0cylcbiAgICBpb25pYy5leHRlbmQgdGhpcywgb3B0c1xuICAgIEBpdGVtSGVpZ2h0ID0gQGxpc3RFbC5jaGlsZHJlblswXSBhbmQgcGFyc2VJbnQoQGxpc3RFbC5jaGlsZHJlblswXS5zdHlsZS5oZWlnaHQsIDEwKSAgaWYgbm90IEBpdGVtSGVpZ2h0IGFuZCBAbGlzdEVsXG4gICAgXG4gICAgI2lvbmljLnZpZXdzLkxpc3RWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0cyk7XG4gICAgQG9uUmVmcmVzaCA9IG9wdHMub25SZWZyZXNoIG9yIC0+XG5cbiAgICBAb25SZWZyZXNoT3BlbmluZyA9IG9wdHMub25SZWZyZXNoT3BlbmluZyBvciAtPlxuXG4gICAgQG9uUmVmcmVzaEhvbGRpbmcgPSBvcHRzLm9uUmVmcmVzaEhvbGRpbmcgb3IgLT5cblxuICAgIHdpbmRvdy5pb25pYy5vbkdlc3R1cmUgXCJyZWxlYXNlXCIsICgoZSkgLT5cbiAgICAgIF90aGlzLl9oYW5kbGVFbmREcmFnIGVcbiAgICAgIHJldHVyblxuICAgICksIEBlbFxuICAgIHdpbmRvdy5pb25pYy5vbkdlc3R1cmUgXCJkcmFnXCIsICgoZSkgLT5cbiAgICAgIF90aGlzLl9oYW5kbGVEcmFnIGVcbiAgICAgIHJldHVyblxuICAgICksIEBlbFxuICAgIFxuICAgICMgU3RhcnQgdGhlIGRyYWcgc3RhdGVzXG4gICAgQF9pbml0RHJhZygpXG4gICAgcmV0dXJuXG5cbiAgXG4gICMjIypcbiAgQ2FsbGVkIHRvIHRlbGwgdGhlIGxpc3QgdG8gc3RvcCByZWZyZXNoaW5nLiBUaGlzIGlzIHVzZWZ1bFxuICBpZiB5b3UgYXJlIHJlZnJlc2hpbmcgdGhlIGxpc3QgYW5kIGFyZSBkb25lIHdpdGggcmVmcmVzaGluZy5cbiAgIyMjXG4gIHN0b3BSZWZyZXNoaW5nOiAtPlxuICAgIHJlZnJlc2hlciA9IEBlbC5xdWVyeVNlbGVjdG9yKFwiLmxpc3QtcmVmcmVzaGVyXCIpXG4gICAgcmVmcmVzaGVyLnN0eWxlLmhlaWdodCA9IFwiMHB4XCJcbiAgICByZXR1cm5cblxuICBcbiAgIyMjKlxuICBJZiB3ZSBzY3JvbGxlZCBhbmQgaGF2ZSB2aXJ0dWFsIG1vZGUgZW5hYmxlZCwgY29tcHV0ZSB0aGUgd2luZG93XG4gIG9mIGFjdGl2ZSBlbGVtZW50cyBpbiBvcmRlciB0byBmaWd1cmUgb3V0IHRoZSB2aWV3cG9ydCB0byByZW5kZXIuXG4gICMjI1xuICBkaWRTY3JvbGw6IChlKSAtPlxuICAgIGlmIEBpc1ZpcnR1YWxcbiAgICAgIGl0ZW1IZWlnaHQgPSBAaXRlbUhlaWdodFxuICAgICAgXG4gICAgICAjIFRPRE86IFRoaXMgd291bGQgYmUgaW5hY2N1cmF0ZSBpZiB3ZSBhcmUgd2luZG93ZWRcbiAgICAgIHRvdGFsSXRlbXMgPSBAbGlzdEVsLmNoaWxkcmVuLmxlbmd0aFxuICAgICAgXG4gICAgICAjIEdyYWIgdGhlIHRvdGFsIGhlaWdodCBvZiB0aGUgbGlzdFxuICAgICAgc2Nyb2xsSGVpZ2h0ID0gZS50YXJnZXQuc2Nyb2xsSGVpZ2h0XG4gICAgICBcbiAgICAgICMgR2V0IHRoZSB2aWV3cG9ydCBoZWlnaHRcbiAgICAgIHZpZXdwb3J0SGVpZ2h0ID0gQGVsLnBhcmVudE5vZGUub2Zmc2V0SGVpZ2h0XG4gICAgICBcbiAgICAgICMgc2Nyb2xsVG9wIGlzIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvblxuICAgICAgc2Nyb2xsVG9wID0gZS5zY3JvbGxUb3BcbiAgICAgIFxuICAgICAgIyBIaWdoIHdhdGVyIGlzIHRoZSBwaXhlbCBwb3NpdGlvbiBvZiB0aGUgZmlyc3QgZWxlbWVudCB0byBpbmNsdWRlIChldmVyeXRoaW5nIGJlZm9yZVxuICAgICAgIyB0aGF0IHdpbGwgYmUgcmVtb3ZlZClcbiAgICAgIGhpZ2hXYXRlciA9IE1hdGgubWF4KDAsIGUuc2Nyb2xsVG9wICsgQHZpcnR1YWxSZW1vdmVUaHJlc2hvbGQpXG4gICAgICBcbiAgICAgICMgTG93IHdhdGVyIGlzIHRoZSBwaXhlbCBwb3NpdGlvbiBvZiB0aGUgbGFzdCBlbGVtZW50IHRvIGluY2x1ZGUgKGV2ZXJ5dGhpbmcgYWZ0ZXJcbiAgICAgICMgdGhhdCB3aWxsIGJlIHJlbW92ZWQpXG4gICAgICBsb3dXYXRlciA9IE1hdGgubWluKHNjcm9sbEhlaWdodCwgTWF0aC5hYnMoZS5zY3JvbGxUb3ApICsgdmlld3BvcnRIZWlnaHQgKyBAdmlydHVhbEFkZFRocmVzaG9sZClcbiAgICAgIFxuICAgICAgIyBDb21wdXRlIGhvdyBtYW55IGl0ZW1zIHBlciB2aWV3cG9ydCBzaXplIGNhbiBzaG93XG4gICAgICBpdGVtc1BlclZpZXdwb3J0ID0gTWF0aC5mbG9vcigobG93V2F0ZXIgLSBoaWdoV2F0ZXIpIC8gaXRlbUhlaWdodClcbiAgICAgIFxuICAgICAgIyBHZXQgdGhlIGZpcnN0IGFuZCBsYXN0IGVsZW1lbnRzIGluIHRoZSBsaXN0IGJhc2VkIG9uIGhvdyBtYW55IGNhbiBmaXRcbiAgICAgICMgYmV0d2VlbiB0aGUgcGl4ZWwgcmFuZ2Ugb2YgbG93V2F0ZXIgYW5kIGhpZ2hXYXRlclxuICAgICAgZmlyc3QgPSBwYXJzZUludChNYXRoLmFicyhoaWdoV2F0ZXIgLyBpdGVtSGVpZ2h0KSwgMTApXG4gICAgICBsYXN0ID0gcGFyc2VJbnQoTWF0aC5hYnMobG93V2F0ZXIgLyBpdGVtSGVpZ2h0KSwgMTApXG4gICAgICBcbiAgICAgICMgR2V0IHRoZSBpdGVtcyB3ZSBuZWVkIHRvIHJlbW92ZVxuICAgICAgQF92aXJ0dWFsSXRlbXNUb1JlbW92ZSA9IEFycmF5OjpzbGljZS5jYWxsKEBsaXN0RWwuY2hpbGRyZW4sIDAsIGZpcnN0KVxuICAgICAgXG4gICAgICAjIEdyYWIgdGhlIG5vZGVzIHdlIHdpbGwgYmUgc2hvd2luZ1xuICAgICAgbm9kZXMgPSBBcnJheTo6c2xpY2UuY2FsbChAbGlzdEVsLmNoaWxkcmVuLCBmaXJzdCwgZmlyc3QgKyBpdGVtc1BlclZpZXdwb3J0KVxuICAgICAgQHJlbmRlclZpZXdwb3J0IGFuZCBAcmVuZGVyVmlld3BvcnQoaGlnaFdhdGVyLCBsb3dXYXRlciwgZmlyc3QsIGxhc3QpXG4gICAgcmV0dXJuXG5cbiAgZGlkU3RvcFNjcm9sbGluZzogKGUpIC0+XG4gICAgaWYgQGlzVmlydHVhbFxuICAgICAgaSA9IDBcblxuICAgICAgd2hpbGUgaSA8IEBfdmlydHVhbEl0ZW1zVG9SZW1vdmUubGVuZ3RoXG4gICAgICAgIGVsID0gQF92aXJ0dWFsSXRlbXNUb1JlbW92ZVtpXVxuICAgICAgICBcbiAgICAgICAgI2VsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xuICAgICAgICBAZGlkSGlkZUl0ZW0gYW5kIEBkaWRIaWRlSXRlbShpKVxuICAgICAgICBpKytcbiAgICByZXR1cm5cblxuICBcbiAgIyBPbmNlIHNjcm9sbGluZyBzdG9wcywgY2hlY2sgaWYgd2UgbmVlZCB0byByZW1vdmUgb2xkIGl0ZW1zXG4gIFxuICAjIyMqXG4gIENsZWFyIGFueSBhY3RpdmUgZHJhZyBlZmZlY3RzIG9uIHRoZSBsaXN0LlxuICAjIyNcbiAgY2xlYXJEcmFnRWZmZWN0czogLT5cbiAgICBpZiBAX2xhc3REcmFnT3BcbiAgICAgIEBfbGFzdERyYWdPcC5jbGVhbiBhbmQgQF9sYXN0RHJhZ09wLmNsZWFuKClcbiAgICAgIEBfbGFzdERyYWdPcCA9IG51bGxcbiAgICByZXR1cm5cblxuICBfaW5pdERyYWc6IC0+XG4gICAgXG4gICAgI2lvbmljLnZpZXdzLkxpc3RWaWV3Ll9fc3VwZXJfXy5faW5pdERyYWcuY2FsbCh0aGlzKTtcbiAgICBcbiAgICAjIFN0b3JlIHRoZSBsYXN0IG9uZVxuICAgIEBfbGFzdERyYWdPcCA9IEBfZHJhZ09wXG4gICAgQF9kcmFnT3AgPSBudWxsXG4gICAgcmV0dXJuXG5cbiAgXG4gICMgUmV0dXJuIHRoZSBsaXN0IGl0ZW0gZnJvbSB0aGUgZ2l2ZW4gdGFyZ2V0XG4gIF9nZXRJdGVtOiAodGFyZ2V0KSAtPlxuICAgIHdoaWxlIHRhcmdldFxuICAgICAgcmV0dXJuIHRhcmdldCAgaWYgdGFyZ2V0LmNsYXNzTGlzdCBhbmQgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhJVEVNX0NMQVNTKVxuICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGVcbiAgICBudWxsXG5cbiAgX3N0YXJ0RHJhZzogKGUpIC0+XG4gICAgX3RoaXMgPSB0aGlzXG4gICAgZGlkU3RhcnQgPSBmYWxzZVxuICAgIEBfaXNEcmFnZ2luZyA9IGZhbHNlXG4gICAgbGFzdERyYWdPcCA9IEBfbGFzdERyYWdPcFxuICAgIGl0ZW0gPSB1bmRlZmluZWRcbiAgICBcbiAgICAjIENoZWNrIGlmIHRoaXMgaXMgYSByZW9yZGVyIGRyYWdcbiAgICBpZiBpb25pYy5Eb21VdGlsLmdldFBhcmVudE9yU2VsZldpdGhDbGFzcyhlLnRhcmdldCwgSVRFTV9SRU9SREVSX0JUTl9DTEFTUykgYW5kIChlLmdlc3R1cmUuZGlyZWN0aW9uIGlzIFwidXBcIiBvciBlLmdlc3R1cmUuZGlyZWN0aW9uIGlzIFwiZG93blwiKVxuICAgICAgaXRlbSA9IEBfZ2V0SXRlbShlLnRhcmdldClcbiAgICAgIGlmIGl0ZW1cbiAgICAgICAgQF9kcmFnT3AgPSBuZXcgUmVvcmRlckRyYWcoXG4gICAgICAgICAgbGlzdEVsOiBAZWxcbiAgICAgICAgICBlbDogaXRlbVxuICAgICAgICAgIHNjcm9sbEVsOiBAc2Nyb2xsRWxcbiAgICAgICAgICBzY3JvbGxWaWV3OiBAc2Nyb2xsVmlld1xuICAgICAgICAgIG9uUmVvcmRlcjogKGVsLCBzdGFydCwgZW5kKSAtPlxuICAgICAgICAgICAgX3RoaXMub25SZW9yZGVyIGFuZCBfdGhpcy5vblJlb3JkZXIoZWwsIHN0YXJ0LCBlbmQpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgKVxuICAgICAgICBAX2RyYWdPcC5zdGFydCBlXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIFxuICAgICMgT3IgY2hlY2sgaWYgdGhpcyBpcyBhIHN3aXBlIHRvIHRoZSBzaWRlIGRyYWdcbiAgICBlbHNlIGlmIG5vdCBAX2RpZERyYWdVcE9yRG93biBhbmQgKGUuZ2VzdHVyZS5kaXJlY3Rpb24gaXMgXCJsZWZ0XCIgb3IgZS5nZXN0dXJlLmRpcmVjdGlvbiBpcyBcInJpZ2h0XCIpIGFuZCBNYXRoLmFicyhlLmdlc3R1cmUuZGVsdGFYKSA+IDVcbiAgICAgIFxuICAgICAgIyBNYWtlIHN1cmUgdGhpcyBpcyBhbiBpdGVtIHdpdGggYnV0dG9uc1xuICAgICAgaXRlbSA9IEBfZ2V0SXRlbShlLnRhcmdldClcbiAgICAgIGlmIGl0ZW0gYW5kIGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5pdGVtLW9wdGlvbnNcIilcbiAgICAgICAgQF9kcmFnT3AgPSBuZXcgU2xpZGVEcmFnKFxuICAgICAgICAgIGVsOiBAZWxcbiAgICAgICAgICBjYW5Td2lwZTogQGNhblN3aXBlXG4gICAgICAgIClcbiAgICAgICAgQF9kcmFnT3Auc3RhcnQgZVxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBcbiAgICAjIElmIHdlIGhhZCBhIGxhc3QgZHJhZyBvcGVyYXRpb24gYW5kIHRoaXMgaXMgYSBuZXcgb25lIG9uIGEgZGlmZmVyZW50IGl0ZW0sIGNsZWFuIHRoYXQgbGFzdCBvbmVcbiAgICBsYXN0RHJhZ09wLmNsZWFuIGFuZCBsYXN0RHJhZ09wLmNsZWFuKCkgIGlmIGxhc3REcmFnT3AgYW5kIEBfZHJhZ09wIGFuZCBub3QgQF9kcmFnT3AuaXNTYW1lSXRlbShsYXN0RHJhZ09wKSBhbmQgZS5kZWZhdWx0UHJldmVudGVkXG4gICAgcmV0dXJuXG5cbiAgX2hhbmRsZUVuZERyYWc6IChlKSAtPlxuICAgIF90aGlzID0gdGhpc1xuICAgIEBfZGlkRHJhZ1VwT3JEb3duID0gZmFsc2VcbiAgICBcbiAgICAjaW9uaWMudmlld3MuTGlzdFZpZXcuX19zdXBlcl9fLl9oYW5kbGVFbmREcmFnLmNhbGwodGhpcywgZSk7XG4gICAgcmV0dXJuICB1bmxlc3MgQF9kcmFnT3BcbiAgICBAX2RyYWdPcC5lbmQgZSwgLT5cbiAgICAgIF90aGlzLl9pbml0RHJhZygpXG4gICAgICByZXR1cm5cblxuICAgIHJldHVyblxuXG4gIFxuICAjIyMqXG4gIFByb2Nlc3MgdGhlIGRyYWcgZXZlbnQgdG8gbW92ZSB0aGUgaXRlbSB0byB0aGUgbGVmdCBvciByaWdodC5cbiAgIyMjXG4gIF9oYW5kbGVEcmFnOiAoZSkgLT5cbiAgICBfdGhpcyA9IHRoaXNcbiAgICBjb250ZW50ID0gdW5kZWZpbmVkXG4gICAgYnV0dG9ucyA9IHVuZGVmaW5lZFxuICAgIEBfZGlkRHJhZ1VwT3JEb3duID0gdHJ1ZSAgaWYgTWF0aC5hYnMoZS5nZXN0dXJlLmRlbHRhWSkgPiA1XG4gICAgXG4gICAgIyBJZiB3ZSBnZXQgYSBkcmFnIGV2ZW50LCBtYWtlIHN1cmUgd2UgYXJlbid0IGluIGFub3RoZXIgZHJhZywgdGhlbiBjaGVjayBpZiB3ZSBzaG91bGRcbiAgICAjIHN0YXJ0IG9uZVxuICAgIEBfc3RhcnREcmFnIGUgIGlmIG5vdCBAaXNEcmFnZ2luZyBhbmQgbm90IEBfZHJhZ09wXG4gICAgXG4gICAgIyBObyBkcmFnIHN0aWxsLCBwYXNzIGl0IHVwXG4gICAgXG4gICAgI2lvbmljLnZpZXdzLkxpc3RWaWV3Ll9fc3VwZXJfXy5faGFuZGxlRHJhZy5jYWxsKHRoaXMsIGUpO1xuICAgIHJldHVybiAgdW5sZXNzIEBfZHJhZ09wXG4gICAgZS5nZXN0dXJlLnNyY0V2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBAX2RyYWdPcC5kcmFnIGVcbiAgICByZXR1cm5cbikiLCJhbmd1bGFyLm1vZHVsZSgnaW9uaWMuY29udHJpYi5UcmVlVmlldycpLmRpcmVjdGl2ZSBcInRyZWVJdGVtXCIsIFtcbiAgXCIkYW5pbWF0ZVwiXG4gIFwiJGNvbXBpbGVcIlxuICAoJGFuaW1hdGUsICRjb21waWxlKSAtPlxuICAgIHJldHVybiAoXG4gICAgICByZXN0cmljdDogXCJFXCJcbiAgICAgIGNvbnRyb2xsZXI6IFtcbiAgICAgICAgXCIkc2NvcGVcIlxuICAgICAgICBcIiRlbGVtZW50XCJcbiAgICAgICAgKCRzY29wZSwgJGVsZW1lbnQpIC0+XG4gICAgICAgICAgJHNjb3BlLnRvZ2dsZSA9ICgkZXZlbnQsIHJvdykgLT5cbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgcm93Lml0ZW0uZXhwYW5kZWQgPSAhcm93Lml0ZW0uZXhwYW5kZWRcbiAgICAgICAgICAgICRzY29wZS5vbkV4cGFuZENoYW5nZSh7IHJvdzogcm93IH0pXG5cbiAgICAgICAgICAkc2NvcGUuY2hlY2tib3hDbGljayA9ICgkZXZlbnQsIHJvdykgLT5cbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgIyB0b2RvOiBjb25maWd1cmFibGVcbiAgICAgICAgICAgIHJvdy5pdGVtLmRvbmUgPSAhcm93Lml0ZW0uZG9uZVxuICAgICAgICAgICAgJHNjb3BlLm9uQ2hlY2tib3hDaGFuZ2UoeyByb3c6IHJvdyB9KVxuXG4gICAgICAgICAgJHNjb3BlLnJvd0NsaWNrID0gKHJvdykgLT5cbiAgICAgICAgICAgICRzY29wZS5vbkNsaWNrKHsgcm93OiByb3cgfSlcbiAgICAgIF1cbiAgICAgIGNvbXBpbGU6ICgkZWxlbWVudCwgJGF0dHJzKSAtPlxuICAgICAgICAkZWxlbWVudC5hZGRDbGFzcyBcIml0ZW0gaXRlbS1jb21wbGV4IHRyZWUtaXRlbVwiXG5cbiAgICAgICAgbGluayA9ICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMpIC0+XG4gICAgICAgICAgJHNjb3BlLmdldFRyZWVQYWRkaW5nID0gKHJvdykgLT5cbiAgICAgICAgICAgIHBhZGRpbmcgPSByb3cubGV2ZWwgKiA0MFxuICAgICAgICAgICAgcmV0dXJuIHsgJ3BhZGRpbmctbGVmdCc6IHBhZGRpbmcgKyAncHgnIH1cbiAgICAgICAgICBcbiAgICAgICAgICAkc2NvcGUuZ2V0VmlzaWJpbGl0eSA9IChyb3cpIC0+XG4gICAgICAgICAgICBpZiByb3cuaXRlbS5oaWRlRXhwYW5kZXJcbiAgICAgICAgICAgICAgcmV0dXJuICdoaWRkZW4nXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgIGlmIHJvdy5pdGVtLmNoaWxkcmVuPy5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgJ3Zpc2libGUnXG4gICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAnaGlkZGVuJ1xuXG4gICAgICAgICAgaWYgJHNjb3BlLnNob3dOdW1iZXJzXG4gICAgICAgICAgICB0cmVlSXRlbU51bWJlckNsYXNzID0gXCJ0cmVlLWl0ZW0td2l0aC1udW1iZXJcIlxuICAgICAgICAgICAgbnVtYmVyID0gYW5ndWxhci5lbGVtZW50KFwiPHNwYW4gY2xhc3M9XFxcInRyZWUtaXRlbS1udW1iZXJcXFwiPiN7JHNjb3BlLnJvdy5udW1iZXIuam9pbignLicpfTo8L3NwYW4+XCIpXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgdHJlZUl0ZW1OdW1iZXJDbGFzcyA9IFwiXCJcblxuICAgICAgICAgIHNob3dDaGVja2JveCA9ICRzY29wZS5yb3cuc2hvd0NoZWNrYm94IHx8ICgkc2NvcGUuc2hvd0NoZWNrYm94ZXMgJiYgJHNjb3BlLnJvdy5zaG93Q2hlY2tib3ggIT0gZmFsc2UpXG4gICAgICAgICAgaWYgc2hvd0NoZWNrYm94XG4gICAgICAgICAgICB0cmVlSXRlbUNoZWNrYm94Q2xhc3MgPSBcInRyZWUtaXRlbS13aXRoLWNoZWNrYm94XCJcbiAgICAgICAgICAgIGNoZWNrYm94ID0gYW5ndWxhci5lbGVtZW50KFwiPGxhYmVsIGNsYXNzPVxcXCJjaGVja2JveFxcXCI+PGlucHV0IHR5cGU9XFxcImNoZWNrYm94XFxcIiBcbiAgICAgICAgICAgICAgbmctY2hlY2tlZD1cXFwicm93Lml0ZW0uZG9uZVxcXCIgbmctY2xpY2s9XFxcImNoZWNrYm94Q2xpY2soJGV2ZW50LCByb3cpXFxcIj48L2xhYmVsPlwiKVxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIHRyZWVJdGVtQ2hlY2tib3hDbGFzcyA9IFwiXCJcblxuICAgICAgICAgIGNvbnRhaW5lckxpbmsgPSBhbmd1bGFyLmVsZW1lbnQoXCI8YSBcbiAgICAgICAgICAgIGNsYXNzPVxcXCJpdGVtLWNvbnRlbnQgaXRlbS1pY29uLXJpZ2h0ICN7dHJlZUl0ZW1DaGVja2JveENsYXNzfSAje3RyZWVJdGVtTnVtYmVyQ2xhc3N9XFxcIiBcbiAgICAgICAgICAgIG5nLWNsaWNrPVxcXCJyb3dDbGljayhyb3cpXFxcIlxuICAgICAgICAgICAgbmctc3R5bGU9XFxcImdldFRyZWVQYWRkaW5nKHJvdylcXFwiXG4gICAgICAgICAgICA+PC9hPlwiKVxuXG4gICAgICAgICAgY2hldnJvbiA9IGFuZ3VsYXIuZWxlbWVudChcIjxhIGNsYXNzPVxcXCJleHBhbmQtYnV0dG9uIGljb24gaW9uLWNoZXZyb24tZG93blxcXCIgXG4gICAgICAgICAgICBuZy1jbGFzcz1cXFwieyd0cmVlLWl0ZW0tZXhwYW5kZWQnOiByb3cuaXRlbS5leHBhbmRlZH1cXFwiIFxuICAgICAgICAgICAgbmctc3R5bGU9XFxcInsndmlzaWJpbGl0eSc6IGdldFZpc2liaWxpdHkocm93KX1cXFwiXG4gICAgICAgICAgICBuZy1jbGljaz1cXFwidG9nZ2xlKCRldmVudCwgcm93KVxcXCI+PC9hPlwiKVxuXG4gICAgICAgICAgdGV4dENvbnRhaW5lciA9IGFuZ3VsYXIuZWxlbWVudChcIjxzcGFuIGNsYXNzPVxcXCJ0cmVlLWl0ZW0tdGV4dFxcXCI+PC9zcGFuPlwiKVxuXG4gICAgICAgICAgdGV4dENvbnRhaW5lci5hcHBlbmQgJGVsZW1lbnQuY29udGVudHMoKVxuXG4gICAgICAgICAgaWYgJHNjb3BlLnNob3dOdW1iZXJzXG4gICAgICAgICAgICBjb250YWluZXJMaW5rLmFwcGVuZChudW1iZXIpXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgc2hvd0NoZWNrYm94XG4gICAgICAgICAgICBjb250YWluZXJMaW5rLmFwcGVuZChjaGVja2JveClcbiAgICAgICAgICBcbiAgICAgICAgICBjb250YWluZXJMaW5rLmFwcGVuZCh0ZXh0Q29udGFpbmVyKS5hcHBlbmQoY2hldnJvbilcblxuICAgICAgICAgICRlbGVtZW50LmFwcGVuZCBjb250YWluZXJMaW5rXG4gICAgICAgICAgJGNvbXBpbGUoY29udGFpbmVyTGluaykoJHNjb3BlKVxuXG4gICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgcmV0dXJuIGxpbmtcbiAgICApXG5dIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9